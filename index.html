<!DOCTYPE html>
<html>
  <head>
    <title>Shopify OAuth Helper</title>
    <style>
      body {
        font-family: sans-serif;
      }
      pre {
        background-color: #eee;
        padding: 1em;
        border-radius: 0.5em;
      }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta robots="noindex, nofollow" />
    <script>
      //@ts-check
      const query = new URLSearchParams(window.location.search);
      const shop = query.get("shop");
      const accessScope = "read_assigned_fulfillment_orders,write_assigned_fulfillment_orders,write_draft_orders,read_draft_orders,write_inventory,read_inventory,write_inventory_shipments,read_inventory_shipments,write_inventory_shipments_received_items,read_inventory_shipments_received_items,write_inventory_transfers,read_inventory_transfers,write_locations,read_locations,read_merchant_managed_fulfillment_orders,write_merchant_managed_fulfillment_orders,read_payment_terms,write_payment_terms,read_payment_customizations,write_payment_customizations,read_product_feeds,write_product_feeds,read_product_listings,write_product_listings,read_products,write_products,read_shopify_payments_provider_accounts_sensitive,read_shopify_payments_accounts,read_shopify_payments_payouts,read_shopify_payments_bank_accounts,read_shopify_payments_disputes,write_shopify_payments_disputes,read_third_party_fulfillment_orders,write_third_party_fulfillment_orders,customer_read_draft_orders,customer_read_orders,customer_write_orders,unauthenticated_read_product_inventory";
      const clientId = query.get("client_id");
      const code = query.get("code");

      if (shop && accessScope && clientId) {
        const url = new URL(`https://${shop}/admin/oauth/authorize`);
        const redirectUrl = new URL(window.location.href)
        redirectUrl.search = ""

        url.searchParams.append("client_id", clientId);
        url.searchParams.append("scope", accessScope);
        // url.searchParams.append("redirect_uri", redirectUrl.href);

        const urlToCopy = url.toString() + `&redirect_uri=${redirectUrl.href}`

        console.warn("Paste this URL to the browser", urlToCopy)
    
      } else if (shop && code) {
        const curl = `curl -X POST https://${shop}/admin/oauth/access_token \
-H "Content-Type: application/json" \
-d '{
  "code": "${code}",
  "client_id": "__client_id_here__",
  "client_secret": "__secret_here__"
}'
`;
        console.warn("Paste this command to the terminal", curl)
      } else {
        console.warn("Missing query parameters", {
          shop,
          accessScope,
          clientId,
          code,
        })
      }
    </script>
  </head>
  <body>
    <h1>Shopify OAuth Helper</h1>
    <p>
      This page is used to help with the Shopify OAuth flow. It will redirect
      the user to the Shopify OAuth page with the correct parameters.
      write_products,write_discounts,write_cart_transforms
    </p>
    <p>
      If the user is redirected back to this page with a <code>code</code> query
      parameter, it will display the <code>curl</code> command to get the access
      token.
    </p>
  </body>
</html>
